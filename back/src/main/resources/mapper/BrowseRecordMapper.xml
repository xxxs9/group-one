<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.heeexy.example.dao.BrowseRecordDao">
    <update id="removeRecord">

    </update>

    <select id="getRecords" resultType="com.alibaba.fastjson.JSONObject">
        SELECT
        u.uuid                                                           uuId,
        u.username                                                            username,
        u.sex                                                                 sex,
        (SELECT categories_name FROM post_categories p1,post_table p2
        WHERE p1.categories_id = p2.post_type_id AND p2.post_id = b.post_id )  categoriesName,
        p.post_text                                                           postText,
        p.post_state                                                          postState,
        b.last_browse_time                                                    lastTime
        FROM
        browse_records b
        left join post_table p on p.post_id = b.post_id
        left join user u on b.user_uuid = u.uuid
        <where>
            <if test="querykey != null and querykey != '' ">
                username LIKE concat('%',#{querykey},'%')
            </if>
        </where>
    </select>
    <select id="getRecordsByName" resultType="com.alibaba.fastjson.JSONObject">
        SELECT
        u.uuid                                                           uuId,
        u.username                                                            username,
        u.sex                                                                 sex,
        (SELECT categories_name FROM post_categories p1,post_table p2
        WHERE p1.categories_id = p2.post_type_id AND p2.post_id = b.post_id )  categoriesName,
        p.post_text                                                           postText,
        p.post_state                                                          postState,
        b.last_browse_time                                                    lastTime
        FROM
        browse_records b
        left join post_table p on p.post_id = b.post_id
        left join user u on b.user_uuid = u.uuid
        <where>
            <if test="querykey != null and querykey != '' ">
                username LIKE concat('%',#{querykey},'%')
            </if>
        </where>
    </select>
</mapper>