<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.heeexy.example.dao.UserAttentionDao">
    <!--获取用户关注的用户uuid-->
    <select id="getMyIdolIdByUUID" resultType="com.alibaba.fastjson.JSONObject">
        SELECT
        to_user_uuid               idolId
        FROM user_attention
        WHERE from_user_uuid = #{uuId} AND delete_status = '1'
    </select>

    <!--获取用户的粉丝用户ID-->
    <select id="getFansUUIDByUUID" resultType="com.alibaba.fastjson.JSONObject">
        SELECT
        from_user_uuid             fansId
        FROM user_attention ua
        WHERE ua.to_user_uuid = #{uuId} AND ua.delete_status = '1'
    </select>

    <!--统计粉丝数量-->
    <select id="countFansByUUID" resultType="java.lang.Integer">
        SELECT
        count(from_user_uuid) fansCount
        FROM user_attention
        WHERE to_user_uuid = #{uuId} AND delete_status = '1'
    </select>
    <!--统计关注数量-->
    <select id="countIdolByUUID" resultType="java.lang.Integer">
        SELECT
        count(to_user_uuid)   idolCount
        FROM user_attention
        WHERE from_user_uuid = #{uuId} AND delete_status = '1'
    </select>
    <!--新增关注-->
    <insert id="addAttention">
        INSERT
        INTO user_attention(from_user_uuid, to_user_uuid)
        VALUES (#{uuId},#{touuId})
    </insert>

    <!--取消关注-->
    <update id="removeAttention">
        UPDATE user_attention
        SET delete_status = '2'
        WHERE from_user_uuid = #{uuId} AND to_user_uuid = #{touuId}

    </update>

    <!--判断是否之前是否关注过并已取关-->
    <select id="queryExist" resultType="java.lang.Integer">
        SELECT count(0)
        FROM user_attention
        WHERE from_user_uuid = #{uuId} AND to_user_uuid = #{touuId} AND delete_status = '2'
    </select>

    <!--恢复关注-->
    <update id="refreshAttention">
        UPDATE user_attention
        SET delete_status = '1'
        WHERE from_user_uuid = #{uuId} AND to_user_uuid = #{touuId} AND delete_status = '2'

    </update>

    <!--判断是否已经关注-->
    <select id="queryAlreadyAttention" resultType="java.lang.Integer">
        SELECT count(0)
        FROM user_attention
        WHERE from_user_uuid = #{uuId} AND to_user_uuid = #{touuId} AND delete_status = '1'

    </select>





</mapper>